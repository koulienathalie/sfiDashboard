================================================================================
  SFI DASHBOARD MONITORING - DEPLOYMENT SUMMARY
  Ubuntu Server 172.27.28.14 | Systemd | Node.js + Nginx
================================================================================

üìÖ DATE: 17 novembre 2025
üìå VERSION: 1.0.0
üéØ OBJECTIF: D√©ploiement production sans Docker

================================================================================
 üìã CONFIGURATION MISE √Ä JOUR
================================================================================

‚úÖ Backend .env - Production Ready
   Fichier: /home/shadowcraft/Projets/sfiDashMonitoring/backend/.env
   - NODE_ENV=production
   - PORT=3001
   - ES_NODE=https://172.27.28.14:9200
   - FRONTEND_URL=http://172.27.28.14
   - JWT_SECRET & JWT_REFRESH_SECRET (√† g√©n√©rer et configurer)

‚úÖ Services Systemd
   Fichier: deployed/sfiDashMonitoring-backend.service
   - User: sfiapp
   - WorkingDirectory: /opt/sfiDashMonitoring/backend
   - Port: 3001
   - Type: simple
   - Restart: always

‚úÖ Configuration Nginx
   Fichier: deployed/nginx.conf
   - Reverse proxy: localhost:3001
   - Port: 80 (HTTP)
   - WebSocket proxy configur√©
   - Security headers activ√©s

================================================================================
 üöÄ SCRIPTS D'INSTALLATION DISPONIBLES
================================================================================

1. install-production.sh
   ‚Üí Installation automatis√©e compl√®te
   ‚Üí Cr√©e l'utilisateur, d√©p√¥t, services, configurations
   ‚Üí Usage: sudo bash install-production.sh
   ‚Üí Temps: ~10-15 minutes

2. verify-deployment.sh
   ‚Üí V√©rification compl√®te du d√©ploiement
   ‚Üí Teste services, ports, connectivit√©, logs
   ‚Üí Usage: sudo bash verify-deployment.sh

3. update-production.sh
   ‚Üí Mise √† jour du code en production
   ‚Üí Git pull + npm install + npm build + red√©marrage
   ‚Üí Usage: sudo bash update-production.sh

4. update-frontend-config.sh
   ‚Üí Met √† jour config frontend pour adresse IP
   ‚Üí Usage: bash update-frontend-config.sh

================================================================================
 üìÇ FICHIERS DE DOCUMENTATION
================================================================================

1. UBUNTU-DEPLOYMENT-GUIDE.md (D√âTAILL√â - 530+ lignes)
   - Installation manuelle √©tape par √©tape
   - Configuration d√©taill√©e de chaque composant
   - Troubleshooting complet
   - Commandes de gestion des services

2. DEPLOYMENT-README.md (R√âSUM√â RAPIDE)
   - Vue d'ensemble architecture
   - Installation rapide en 5 √©tapes
   - Commandes essentielles
   - Checklist final

3. POST-INSTALLATION-CHECKLIST.md (V√âRIFICATIONS)
   - 10 √©tapes de v√©rification post-installation
   - Configuration de s√©curit√© (JWT secrets)
   - Setup backups et logs
   - Probl√®mes courants et solutions

4. DEPLOYMENT-INDEX.md (INDEX COMPLET)
   - Vue d'ensemble de tous les fichiers
   - Commandes essentielles
   - Points de s√©curit√© critiques
   - Troubleshooting rapide

================================================================================
 ‚ö° INSTALLATION RAPIDE (10-15 MIN)
================================================================================

√âTAPE 1: Sur votre machine locale
  $ scp deployed/install-production.sh user@172.27.28.14:/tmp/
  $ ssh user@172.27.28.14

√âTAPE 2: Sur le serveur Ubuntu (en tant que root ou sudo)
  $ sudo bash /tmp/install-production.sh
  
  Le script:
  ‚úì Installe Node.js 18+, Nginx, Git
  ‚úì Cr√©e l'utilisateur 'sfiapp'
  ‚úì Pr√©pare /opt/sfiDashMonitoring
  ‚úì Installe d√©pendances (frontend + backend)
  ‚úì Compile le frontend
  ‚úì Configure Nginx
  ‚úì Cr√©e les services Systemd

√âTAPE 3: Configuration des secrets
  $ sudo nano /opt/sfiDashMonitoring/backend/.env
  
  Modifier (OBLIGATOIRE):
  JWT_SECRET=<g√©n√©rer avec: openssl rand -base64 32>
  JWT_REFRESH_SECRET=<g√©n√©rer avec: openssl rand -base64 32>

√âTAPE 4: D√©marrage
  $ sudo systemctl start sfiDashMonitoring-backend
  $ sudo systemctl status sfiDashMonitoring-backend

√âTAPE 5: Acc√®s
  Ouvrir navigateur: http://172.27.28.14

================================================================================
 üîß STRUCTURE DE D√âPLOIEMENT
================================================================================

R√âPERTOIRE APPLICATION:
  /opt/sfiDashMonitoring/
  ‚îú‚îÄ‚îÄ backend/
  ‚îÇ   ‚îú‚îÄ‚îÄ .env (configuration - CONFIDENTIEL)
  ‚îÇ   ‚îú‚îÄ‚îÄ server.js
  ‚îÇ   ‚îú‚îÄ‚îÄ src/
  ‚îÇ   ‚îú‚îÄ‚îÄ certs/http_ca.crt (certificat Elasticsearch)
  ‚îÇ   ‚îî‚îÄ‚îÄ node_modules/
  ‚îú‚îÄ‚îÄ src/ (frontend source)
  ‚îú‚îÄ‚îÄ dist/ (frontend compil√© ‚Üí Nginx)
  ‚îú‚îÄ‚îÄ deployed/ (ce dossier - scripts & config)
  ‚îî‚îÄ‚îÄ logs/ (logs applicatifs)

CONFIGURATION SYST√àME:
  /etc/systemd/system/sfiDashMonitoring-backend.service
  /etc/nginx/nginx.conf
  
FRONTEND:
  /usr/share/nginx/html/ (fichiers servis par Nginx)

UTILISATEUR:
  sfiapp:sfiapp (propri√©taire de /opt/sfiDashMonitoring)

================================================================================
 üéØ ACCESSIBILIT√â
================================================================================

URL PRODUCTION:
  http://172.27.28.14

PORTS:
  Port 80  ‚Üí Nginx (reverse proxy, accessible publiquement)
  Port 3001 ‚Üí Backend Node.js (interne, accessible via Nginx)
  Port 9200 ‚Üí Elasticsearch (externe: 172.27.28.14)

ARCHITECTURE:
  Navigateur (port 80)
     ‚Üì
  Nginx (reverse proxy)
     ‚îú‚Üí /api ‚Üí Backend (3001)
     ‚îú‚Üí /socket.io ‚Üí Backend WebSocket (3001)
     ‚îî‚Üí / ‚Üí Frontend (fichiers statiques)
     ‚Üì
  Backend Node.js (3001)
     ‚Üì
  Elasticsearch (172.27.28.14:9200)

================================================================================
 üîí S√âCURIT√â - POINTS CRITIQUES
================================================================================

1. JWT SECRETS (OBLIGATOIRE!)
   G√©n√©rer:    openssl rand -base64 32
   Configurer: Dans /opt/sfiDashMonitoring/backend/.env
   Impact:     Authentification, sessions utilisateur

2. FICHIER .ENV
   Contient:   Secrets, mots de passe, cl√©s API
   Prot√©ger:   Jamais commiter dans Git
   Permission: 600 (sfiapp:sfiapp)
   Backup:     Sauvegarder en lieu s√ªr

3. CERTIFICAT ELASTICSEARCH
   Emplacement: /opt/sfiDashMonitoring/backend/certs/http_ca.crt
   Crit√®re:    Must exist and be readable by sfiapp
   Protocole:  HTTPS obligatoire

4. PARE-FEU
   Ouvrir:     Port 80 (HTTP) uniquement
   Fermer:     Port 3001 (backend interne)
   Commande:   sudo ufw allow 80/tcp

5. HEADERS DE S√âCURIT√â
   D√©j√† configur√©s dans nginx.conf:
   - X-Frame-Options: SAMEORIGIN
   - X-Content-Type-Options: nosniff
   - X-XSS-Protection: 1; mode=block
   - Referrer-Policy: strict-origin-when-cross-origin

================================================================================
 üìä COMMANDES ESSENTIELLES
================================================================================

STATUT & GESTION:
  sudo systemctl status sfiDashMonitoring-backend
  sudo systemctl start sfiDashMonitoring-backend
  sudo systemctl stop sfiDashMonitoring-backend
  sudo systemctl restart sfiDashMonitoring-backend
  sudo systemctl enable sfiDashMonitoring-backend
  sudo systemctl disable sfiDashMonitoring-backend

LOGS:
  sudo journalctl -u sfiDashMonitoring-backend -f        (temps r√©el)
  sudo journalctl -u sfiDashMonitoring-backend -n 100    (100 derni√®res)
  sudo journalctl -u sfiDashMonitoring-backend -p err    (erreurs)
  tail -f /var/log/nginx/error.log                       (Nginx erreurs)

V√âRIFICATION:
  sudo systemctl status sfiDashMonitoring-backend
  sudo nginx -t                                  (test Nginx)
  sudo netstat -tlnp | grep -E ':80|:3001'     (ports actifs)
  curl http://localhost                         (test frontend)
  curl http://localhost:3001/api                (test backend)

ELASTICSEARCH:
  curl -k --user stgSFI:Police2405$ \
    https://172.27.28.14:9200

CONFIGURATION:
  sudo nano /opt/sfiDashMonitoring/backend/.env
  sudo nano /etc/nginx/nginx.conf
  sudo systemctl daemon-reload                  (recharger systemd)

================================================================================
 üîÑ MISES √Ä JOUR FUTURES
================================================================================

OPTION 1: Script automatis√© (RECOMMAND√â)
  $ sudo bash /opt/sfiDashMonitoring/deployed/update-production.sh
  
  Fait:
  ‚úì Arr√™te le service
  ‚úì Git pull (ou attend copie manuelle)
  ‚úì npm install (backend)
  ‚úì npm build (frontend)
  ‚úì Copie dist/ ‚Üí Nginx
  ‚úì Red√©marre les services

OPTION 2: Manuel
  $ cd /opt/sfiDashMonitoring
  $ git pull origin main  (ou copier les fichiers)
  $ cd backend && npm install
  $ cd /opt/sfiDashMonitoring && npm run build
  $ sudo cp -r dist/* /usr/share/nginx/html/
  $ sudo systemctl restart sfiDashMonitoring-backend nginx

OPTION 3: Red√©ploiement complet
  $ sudo bash /opt/sfiDashMonitoring/deployed/install-production.sh

================================================================================
 üêõ D√âPANNAGE RAPIDE
================================================================================

PROBL√àME: Backend n'est pas actif
  Diagnostic: sudo journalctl -u sfiDashMonitoring-backend -n 50 -e
  Solution 1: sudo systemctl restart sfiDashMonitoring-backend
  Solution 2: V√©rifier .env (nano /opt/sfiDashMonitoring/backend/.env)
  Solution 3: V√©rifier certificat Elasticsearch

PROBL√àME: 502 Bad Gateway
  Diagnostic: sudo netstat -tlnp | grep 3001
  Solution: sudo systemctl restart sfiDashMonitoring-backend nginx

PROBL√àME: WebSocket ne fonctionne pas
  Diagnostic: F12 ‚Üí Console ‚Üí v√©rifier erreurs WebSocket
  Solution: sudo systemctl restart nginx

PROBL√àME: Frontend ne charge pas
  Diagnostic: curl http://localhost
  Solution: sudo cp -r /opt/sfiDashMonitoring/dist/* /usr/share/nginx/html/

PROBL√àME: Elasticsearch indisponible
  Diagnostic: curl -k --user stgSFI:Police2405$ https://172.27.28.14:9200
  Solution: V√©rifier certificat, password, connectivit√© r√©seau

================================================================================
 ‚úÖ V√âRIFICATION FINALE
================================================================================

Ex√©cuter le script de v√©rification:
  $ sudo bash /opt/sfiDashMonitoring/deployed/verify-deployment.sh

Devrait afficher: ‚úÖ Tous les tests r√©ussis

Checklist post-installation:
  ‚òê Services actifs (backend + Nginx)
  ‚òê Frontend accessible (http://localhost)
  ‚òê Backend API accessible (http://localhost:3001)
  ‚òê WebSocket fonctionne (F12 ‚Üí pas d'erreurs)
  ‚òê Elasticsearch accessible
  ‚òê Secrets JWT configur√©s
  ‚òê Logs sans erreurs critiques
  ‚òê URL externe fonctionnelle (http://172.27.28.14)

================================================================================
 üìû SUPPORT & RESSOURCES
================================================================================

DOCUMENTATION COMPL√àTE:
  ‚Üí UBUNTU-DEPLOYMENT-GUIDE.md (530+ lignes)

R√âSUM√â RAPIDE:
  ‚Üí DEPLOYMENT-README.md

V√âRIFICATIONS POST-INSTALL:
  ‚Üí POST-INSTALLATION-CHECKLIST.md

TOUS LES FICHIERS:
  ‚Üí DEPLOYMENT-INDEX.md

LOGS TEMPS R√âEL:
  $ sudo journalctl -u sfiDashMonitoring-backend -f

CONFIGURATION:
  $ cat /opt/sfiDashMonitoring/backend/.env

TEST DE CONNECTIVIT√â:
  $ curl http://172.27.28.14
  $ curl http://localhost:3001/api
  $ curl -k --user stgSFI:Police2405$ https://172.27.28.14:9200

================================================================================
 üéâ R√âSUM√â
================================================================================

‚úÖ D√âPLOIEMENT CONFIGUR√â ET PR√äT

Adresse IP Serveur:   172.27.28.14
Syst√®me:              Ubuntu Server 20.04/22.04 LTS
Architecture:         Systemd + Node.js + Nginx
Frontend Port:        80 (HTTP)
Backend Port:         3001 (interne)
Elasticsearch:        172.27.28.14:9200 (externe)

URL D'ACC√àS:           http://172.27.28.14

PROCHAINES √âTAPES:
  1. Ex√©cuter: sudo bash /tmp/install-production.sh
  2. Configurer JWT secrets dans .env
  3. D√©marrer: sudo systemctl start sfiDashMonitoring-backend
  4. V√©rifier: sudo bash deployed/verify-deployment.sh
  5. Acc√©der: http://172.27.28.14

TEMPS ESTIM√â: 10-15 minutes

================================================================================
 D√©ploiement cr√©√© le 17 novembre 2025 - SFI Team
================================================================================
